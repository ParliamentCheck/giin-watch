"""
はたらく議員 — コレクター共通設定
全スクリプトが参照する定数・マッピング・環境変数をここに集約する。
"""

import os
from datetime import date, timedelta

# ============================================================
# 環境変数
# ============================================================
SUPABASE_URL = os.environ["SUPABASE_URL"]
SUPABASE_KEY = os.environ["SUPABASE_KEY"]

# NDL API 取得期間（デフォルト: 直近1年）
NDL_DATE_FROM = os.environ.get(
    "NDL_DATE_FROM",
    (date.today() - timedelta(days=365)).isoformat(),
)
NDL_DATE_UNTIL = os.environ.get("NDL_DATE_UNTIL", date.today().isoformat())

# ============================================================
# NDL API 設定
# ============================================================
NDL_API_BASE = "https://kokkai.ndl.go.jp/api/speech"
NDL_RATE_LIMIT_SEC = 0.5  # 1リクエスト / 0.5秒

# ============================================================
# 政党名正規化マップ
# 会派名(部分一致) → 表示用政党名
# ============================================================
PARTY_MAP: dict[str, str] = {
    "自由民主": "自民党",
    "自民": "自民党",
    "立憲民主": "立憲民主党",
    "立憲": "立憲民主党",
    "公明": "公明党",
    "日本維新": "日本維新の会",
    "維新": "日本維新の会",
    "国民民主": "国民民主党",
    "国民": "国民民主党",
    "日本共産": "共産党",
    "共産": "共産党",
    "れいわ": "れいわ新選組",
    "社会民主": "社民党",
    "社民": "社民党",
    "参政": "参政党",
    "チームみらい": "チームみらい",
    "みらい": "チームみらい",
    "日本保守": "日本保守党",
    "沖縄の風": "沖縄の風",
    "中道改革連合": "中道改革連合",
    "中道": "中道改革連合",
    "有志": "有志の会",
    "各派に属しない": "無所属",
    "減税保守こども": "無所属",
    "不明（前議員）": "無所属",
    "ＮＨＫから国民を守る党": "NHK党",
    "NHK": "NHK党",
    "教育無償化を実現する会": "日本維新の会",
    "新緑風会": "国民民主党",
    "無所属": "無所属",
}

# 長いキーを先にマッチさせるためソート済みリスト
PARTY_MAP_KEYS_SORTED = sorted(PARTY_MAP.keys(), key=len, reverse=True)

# 与党
RULING_PARTIES: list[str] = ["自民党", "日本維新の会"]

# ============================================================
# 質問主意書 — セッション別最大番号（衆議院）
# ============================================================
SESSION_MAX: dict[int, int] = {
    196: 487, 197: 145, 198: 309, 199: 20,
    200: 186, 201: 276, 202: 31, 203: 83,
    204: 236, 205: 22, 206: 22, 207: 42,
    208: 156, 209: 41, 210: 68, 211: 156,
    212: 141, 213: 206, 214: 56, 215: 51,
    216: 107, 217: 352, 218: 21, 219: 205,
    220: 8, 221: 300,
}

# ============================================================
# ワードクラウド — ストップワード
# ============================================================
STOP_WORDS: set[str] = {
    # 役職名
    "総理", "総理大臣", "内閣総理大臣",
    # 一般的すぎる国会用語
    "委員", "議員", "政府", "質問", "答弁", "法案", "審議",
    "国会", "会議", "議論", "説明", "意見", "賛成", "反対",
    "提出", "報告", "検討", "措置", "制度", "対策", "問題",
    "状況", "必要", "実施", "確認", "理解", "指摘", "趣旨",
    "大臣", "副大臣", "政務官",  # 単体での出現
    # 形式的語
    "こと", "もの", "ため", "よう", "それ", "これ", "ここ",
    "ところ", "わけ", "はず", "つもり", "とき", "ほう",
    "そこ", "あれ", "どこ", "どれ", "なに",
    # 数詞・記号類は形態素解析側で除外
}

# endswithで除外するサフィックス（「○○大臣」「○○長官」等）
STOP_WORD_SUFFIXES: tuple[str, ...] = (
    "大臣", "副大臣", "政務官", "長官",
)

# ============================================================
# ワードクラウド — パラメータ
# ============================================================
KEYWORDS_MAX_STORE = 100   # DB保持上限
KEYWORDS_MAX_DISPLAY = 50  # フロント表示上限
KEYWORDS_STALE_DAYS = 365  # この日数以上前のワードは入替対象
MIN_SPEECH_LENGTH = 30     # これ以下の発言は相槌扱いで除外

# ============================================================
# 議事進行発言の判定パターン
# ============================================================
PROCEDURAL_ROLES: tuple[str, ...] = ("委員長", "会長", "議長")

# ============================================================
# Supabase バッチサイズ
# ============================================================
UPSERT_BATCH_SIZE = 500  # 大量upsert時の分割サイズ

# ============================================================
# ログ設定
# ============================================================
import logging

LOG_FORMAT = "%(asctime)s [%(levelname)s] %(name)s: %(message)s"
LOG_LEVEL = os.environ.get("LOG_LEVEL", "INFO").upper()

logging.basicConfig(format=LOG_FORMAT, level=getattr(logging, LOG_LEVEL, logging.INFO))
